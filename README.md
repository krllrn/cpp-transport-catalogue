# Transport catalogue
Система храненит остановки и транспортные маршруты, обрабатывает запросов к этой системе.
Поддерживает графический вывод, поиск маршрутов и вычисление времени поездки.

## Формат ввода базы данных
Данные поступают из stdin в формате JSON-объекта. Его верхнеуровневая структура:

{
  "base_requests": [ ... ],
  "stat_requests": [ ... ]
} 

Это словарь, содержащий ключи:

- base_requests — массив с описанием автобусных маршрутов и остановок,
- stat_requests — массив с запросами к транспортному справочнику.

Внимание, JSON может быть отформатирован произвольным образом: использовать или не использовать пробелы для отступов, ключи объектов могут быть расположены в разных строках или в одной.

### Описание базы маршрутов
Массив base_requests содержит элементы двух типов: маршруты и остановки. Они перечисляются в произвольном порядке.
Пример описания остановки:
```
{
  "type": "Stop",
  "name": "Электросети",
  "latitude": 43.598701,
  "longitude": 39.730623,
  "road_distances": {
    "Улица Докучаева": 3000,
    "Улица Лизы Чайкиной": 4300
  }
}
```
### Описание остановки — словарь с ключами:

- type — строка, равная "Stop". Означает, что словарь описывает остановку;
- name — название остановки;
- latitude и longitude — широта и долгота остановки — числа с плавающей запятой;
- road_distances — словарь, задающий дорожное расстояние от этой остановки до соседних. Каждый ключ в этом словаре — название соседней остановки, значение — целочисленное расстояние в метрах.
Пример описания автобусного маршрута:
```
{
  "type": "Bus",
  "name": "14",
  "stops": [
    "Улица Лизы Чайкиной",
    "Электросети",
    "Улица Докучаева",
    "Улица Лизы Чайкиной"
  ],
  "is_roundtrip": true
}
```
### Описание автобусного маршрута — словарь с ключами:

- type — строка "Bus". Означает, что словарь описывает автобусный маршрут;
- name — название маршрута;
- stops — массив с названиями остановок, через которые проходит маршрут. У кольцевого маршрута название последней остановки дублирует название первой. Например: `["stop1", "stop2", "stop3", "stop1"]`;
- is_roundtrip — значение типа bool. true, если маршрут кольцевой.

## Формат запросов к транспортному справочнику и ответов на них
Запросы хранятся в массиве stat_requests. В ответ на них программа выводит в stdout JSON-массив ответов:
```
[
  { ответ на первый запрос },
  { ответ на второй запрос },
  ...
  { ответ на последний запрос }
] 
```
Каждый запрос — словарь с обязательными ключами id и type. Они задают уникальный числовой идентификатор запроса и его тип. В словаре могут быть и другие ключи, специфичные для конкретного типа запроса.
В выходном JSON-массиве на каждый запрос `stat_requests` есть ответ в виде словаря с обязательным ключом `request_id`. Значение ключа равно id соответствующего запроса. В словаре возможны и другие ключи, специфичные для конкретного типа ответа.
Порядок следования ответов на запросы в выходном массиве совпадает с порядком запросов в массиве `stat_requests`.
### Получение информации о маршруте
Формат запроса:
```
{
  "id": 12345678,
  "type": "Bus",
  "name": "14"
} 
```
Ключ `type` имеет значение “Bus”. По нему можно определить, что это запрос на получение информации о маршруте.
Ключ `name` задаёт название маршрута, для которого приложение должно вывести статистическую информацию.
Ответ на этот запрос возвращается в виде словаря:
```
{
  "curvature": 2.18604,
  "request_id": 12345678,
  "route_length": 9300,
  "stop_count": 4,
  "unique_stop_count": 3
} 
```
Ключи словаря:

- curvature — извилистость маршрута. Она равна отношению длины дорожного расстояния маршрута к длине географического расстояния. Число типа double;
- request_id — должен быть равен id соответствующего запроса Bus. Целое число;
- route_length — длина дорожного расстояния маршрута в метрах, целое число;
- stop_count — количество остановок на маршруте;
- unique_stop_count — количество уникальных остановок на маршруте.
Если в справочнике нет маршрута с указанным названием, ответ:
```
{
  "request_id": 12345678,
  "error_message": "not found"
}
```

### Получение информации об остановке
Формат запроса:
```
{
  "id": 12345,
  "type": "Stop",
  "name": "Улица Докучаева"
} 
```
Ключ `name` задаёт название остановки.
Ответ на запрос:
```
{
  "buses": [
      "14", "22к"
  ],
  "request_id": 12345
} 
```
Значение ключей ответа:

- buses — массив названий маршрутов, которые проходят через эту остановку. Названия отсортированы в лексикографическом порядке.
- request_id — целое число, равное id соответствующего запроса Stop.

Если в справочнике нет остановки с переданным названием, ответ на запрос такой:
```
{
  "request_id": 12345,
  "error_message": "not found"
}
```

## Визуализация линий маршрутов
Применяется своя библиотека SVG, чтобы вывести в stdout карту с линиями маршрутов.
### Входные данные
Чтобы управлять визуализацией карты, во входном JSON-документе добавляется словарь `render_settings`.
```
{
  "base_requests": [ ... ],
  "render_settings": { ... },
  "stat_requests": [ ... ]
} 
```
Структура словаря `render_settings`:
```
{
  "width": 1200.0,
  "height": 1200.0,

  "padding": 50.0,

  "line_width": 14.0,
  "stop_radius": 5.0,

  "bus_label_font_size": 20,
  "bus_label_offset": [7.0, 15.0],

  "stop_label_font_size": 20,
  "stop_label_offset": [7.0, -3.0],

  "underlayer_color": [255, 255, 255, 0.85],
  "underlayer_width": 3.0,

  "color_palette": [
    "green",
    [255, 160, 0],
    "red"
  ]
} 
```
- width и height — ширина и высота изображения в пикселях. Вещественное число в диапазоне от 0 до 100000.
- padding — отступ краёв карты от границ SVG-документа. Вещественное число не меньше 0 и меньше min(width, height)/2.
- line_width — толщина линий, которыми рисуются автобусные маршруты. Вещественное число в диапазоне от 0 до 100000.
- stop_radius — радиус окружностей, которыми обозначаются остановки. Вещественное число в диапазоне от 0 до 100000.
- bus_label_font_size — размер текста, которым написаны названия автобусных маршрутов. Целое число в диапазоне от 0 до 100000.
- bus_label_offset — смещение надписи с названием маршрута относительно координат конечной остановки на карте. Массив из двух элементов типа double. Задаёт значения свойств dx и dy SVG-элемента <text>. Элементы массива — числа в диапазоне от –100000 до 100000.
- stop_label_font_size — размер текста, которым отображаются названия остановок. Целое число в диапазоне от 0 до 100000.
- stop_label_offset — смещение названия остановки относительно её координат на карте. Массив из двух элементов типа double. Задаёт значения свойств dx и dy SVG-элемента <text>. Числа в диапазоне от –100000 до 100000.
- underlayer_color — цвет подложки под названиями остановок и маршрутов. Формат хранения цвета будет ниже.
- underlayer_width — толщина подложки под названиями остановок и маршрутов. Задаёт значение атрибута stroke-width элемента <text>. Вещественное число в диапазоне от 0 до 100000.
- color_palette — цветовая палитра. Непустой массив.

Цвет можно указать в одном из следующих форматов:

- в виде строки, например, "red" или "black";
- в массиве из трёх целых чисел диапазона [0, 255]. Они определяют r, g и b компоненты цвета в формате svg::Rgb. Цвет [255, 16, 12] нужно вывести в SVG как rgb(255,16,12);
- в массиве из четырёх элементов: три целых числа в диапазоне от [0, 255] и одно вещественное число в диапазоне от [0.0, 1.0]. Они задают составляющие red, green, blue и opacity цвета формата svg::Rgba. Цвет, заданный как [255, 200, 23, 0.85], должен быть выведен в SVG как rgba(255,200,23,0.85).

Гарантируется, что каждый цвет задан в одном из этих трёх форматов.
### Выходные данные
В stdout программа выводит SVG-изображение карты. Обрабатывать содержимое ключа stat_requests и выводить JSON с ответами на запросы к транспортному справочнику не нужно.
